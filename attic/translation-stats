#!/usr/bin/env python3
from datetime import datetime
from datetime import date
from datetime import time
import pandas as pd

EPOCH_DATE = date(1900, 1, 1)
EPOCH_DATETIME = datetime(1900, 1, 1, 0, 0, 0)


def time_to_hours(t):
    if t is None:
        return None
    if isinstance(t, time):
        t = datetime.combine(EPOCH_DATE, t)
    if isinstance(t, datetime):
        return (t - EPOCH_DATETIME).total_seconds() / 3600
    raise ValueError(repr(t))


stats = pd.read_excel(
    "/Users/erez/translation/skel/stats.xls",
    converters={"Time": time_to_hours},
)
stats.Time = stats.Time.astype(float)
stats = stats[~stats.Time.isna()]
stats = stats.groupby(["Lg", "T/E"]).sum()
stats["O-W/H"] = (stats["O-Words"] / stats["Time"]).round(0).astype(int)
stats["O-Words"] = stats["O-Words"].map('{:,.0f}'.format)
stats = stats[["O-Words", "O-W/H"]]
stats.sort_values(["T/E", "O-W/H"], ascending=[False, True], inplace=True)
print(stats)
print(datetime.utcnow())
